<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>NMdata FAQ</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">NMdata FAQ</h1>



<p>Built 2021-07-08 using NMdata 0.0.8.</p>
<p>This vignette is still under development. Please make sure to see latest version available <a href="https://philipdelff.github.io/NMdata/">here</a>.</p>
<div id="general-nmdata-questions" class="section level2">
<h2>General NMdata questions</h2>
</div>
<div id="what-is-nmdata" class="section level2">
<h2>What is NMdata?</h2>
<div id="nmdata-is-an-r-package-that-can-help" class="section level3">
<h3>NMdata is an R package that can help</h3>
<ul>
<li>Creating event-based data sets for PK/PD modeling</li>
<li>Keeping Nonmem code updated to match contents of datasets</li>
<li>Read all output data and combine with input data from Nonmem runs</li>
<li>supply output list file (.lst), and the reader is very flexible and automated</li>
</ul>
<p>NMdata comes with a configuration tool that can be used to tailor default behaviour to the user’s system configuration and preferences.</p>
</div>
<div id="nmdata-is-not" class="section level3">
<h3>NMdata is not</h3>
<ul>
<li>A plotting package</li>
<li>A tool to retrieve details about model runs</li>
<li>A calculation or simulation toolbox</li>
<li>A “silo” that requires you to do things in a certain way
<ul>
<li>No tools in NMdata requires other NMdata tools to be used</li>
</ul></li>
</ul>
</div>
<div id="how-do-i-install-nmdata" class="section level3">
<h3>How do I install NMdata?</h3>
<p>To get the development version of NMdata, do the following from within R:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(remotes)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">install_github</span>(<span class="st">&quot;philipdelff/NMdata&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">library</span>(NMdata)</span></code></pre></div>
<p>In a production environment, use a <a href="https://github.com/philipdelff/NMdata/releases">github release</a> To install <code>NMdata X.Y.Z</code> release, do (notice “<span class="citation">@v</span>”:)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">library</span>(remotes)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="kw">install_github</span>(<span class="st">&quot;philipdelff/NMdata@vX.Y.Z&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="kw">library</span>(NMdata)</span></code></pre></div>
<p>This example is not automatically updated to latest available release. Please make sure to check for latest version on (<a href="https://github.com/philipdelff/NMdata/releases" class="uri">https://github.com/philipdelff/NMdata/releases</a>)</p>
<p>If you need to archive a script that is dependent on a feature or bug fix which is only in the master branch, you can request a release.</p>
</div>
<div id="what-about-nmdata-dependencies" class="section level3">
<h3>What about NMdata dependencies?</h3>
<p>NMdata depends on <code>data.table</code> only, and <code>data.table</code> does not have any dependencies. R 3.0 or later is required, that’s all (yes, you can run NMdata on pretty old R installations without any difference).</p>
</div>
<div id="why-one-more-tool-for-interacting-with-nonmem-from-r" class="section level3">
<h3>Why one more tool for interacting with Nonmem from R?</h3>
<p>Other tools exist for reading data from Nonmem. However, they most often have requirements to how the dataset or the Nonmem control stream is written. NMdata aims at assuming as little as possible about how you work while still doing (and checking) as much as possible for you.</p>
<p>Tools in NMdata do not assume you use other tools in NMdata. If you like just one function in NMdata and want to integrate that in your workflow, that is perfectly possible. NMdata aims at being able to integrate with anything else and still do the job.</p>
<p>While many other tools available provide plotting functions, NMdata focuses on getting the data ready for smooth Nonmem experience (by checking as much as possible first), get the resulting data out of Nonmem and a little processing.</p>
<p>If you are building applications that process data from Nonmem, you may find very valuable tools in NMdata. I have not seen as generic and flexible a Nonmem data reader elsewhere.</p>
</div>
<div id="i-use-another-tool-that-automatically-reads-my-data.-should-i-be-interested-in-nmdata" class="section level3">
<h3>I use another tool that automatically reads my data. Should I be interested in NMdata?</h3>
<p>The data creation tools in NMdata may still be interesting. If another tool is working well for a project, you may not have any reason to use <code>NMscanData</code> (the Nonmem data reader in NMdata) for it. However, a lot of the time those tools have certain requirements to how datasets are constructed and especially how data is exported from Nonmem (<code>$TABLE</code>). If a Nonmem run does not live up to those requirements, and you want to look at the run results, <code>NMscanData</code> will let you do that without you having to “correct” your <code>$TABLE</code> statements and wait for Nonmem to run again.</p>
<p>Also, in other cases <code>NMscanData</code> can save you a lot of time and frustration even if you have your own routines for these tasks. It will allow you to easily read your old Nonmem runs that were done a little differently, or if you need to read someone else’s work. A meta analysis of a large number of models implemented by different people over the years? That’s a candy store for <code>NMscanData</code>. Here, NMdata can save you many hours of frustration.</p>
</div>
<div id="how-can-nmscandata-do-all-that-only-based-on-the-nonmem-output-list-file" class="section level3">
<h3>How can <code>NMscanData</code> do all that only based on the Nonmem output list file</h3>
<p><code>NMscanData</code> reads the names of the input and output tables from the list file, the path to the input data from the control stream (which it knows where to find, or you can change the method it uses to find it), and then it checks several properties of these files and their contents before combining all the info. It is quite a lot of checking and book keeping but the key steps are simple.</p>
</div>
<div id="why-is-nmdata-fast" class="section level3">
<h3>Why is NMdata fast?</h3>
<p>NMdata is generally fast - all thanks to the incredible <code>data.table</code> package. If you don’t use <code>data.table</code> already, NMdata may even seem extremely fast. If you are noticing some circumstances where NMdata seems slow, I am very curious to hear about it.</p>
</div>
<div id="so-nmdata-uses-data.table.-does-that-mean-variables-are-modified-by-reference" class="section level3">
<h3>So NMdata uses data.table. Does that mean variables are modified by reference?</h3>
<p>NMdata definitely modify variables by reference internally but this will never affect your workspace. It might improve speed to go all the way, and modify by reference in the user workspace, but using NMdata must be easy for R users at all levels of experience. If you don’t understand what this is all about, you’re fine.</p>
</div>
<div id="i-want-to-use-a-tool-from-nmdata-but-how-does-it-integrate-with-dplyr-or-data.table" class="section level3">
<h3>I want to use a tool from NMdata, but how does it integrate with dplyr or data.table?</h3>
<p>Every function in NMdata has an argument called <code>as.fun</code>. You can provide a function in this argument which will be applied to data before returning it.</p>
<p>You can get a tibble if you work with <code>dplyr</code>/<code>tidyverse</code> tools:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">NMscanData</span>(..., <span class="dt">as.fun =</span> tibble<span class="op">::</span>as_tibble)</span></code></pre></div>
<p>Under the hood, NMdata is implemented in <code>data.table</code>, and in fact the default is to convert to <code>data.frame</code> before returning the output. So if you want to have <code>data.table</code>’s back, use <code>as.fun=&quot;data.table&quot;</code> (notice as a character string, not a function) to avoid the conversion</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">NMscanData</span>(..., <span class="dt">as.fun =</span> <span class="st">&quot;data.table&quot;</span>)</span></code></pre></div>
<p>Using <code>as.fun=as.data.table</code> (a function this time) wold work but is not recommended, because that would do an unnecessary copy of data.</p>
<p>If you want to change the behaviour generally for the session and omit the <code>as.fun</code> argument, you can do this by this option:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="co">## for tibbles</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="kw">NMdataConfig</span>(<span class="dt">as.fun =</span> tibble<span class="op">::</span>as_tibble)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="co">## for data.table</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="kw">NMdataConfig</span>(<span class="dt">as.fun =</span> <span class="st">&quot;data.table&quot;</span>)</span></code></pre></div>
<p>All NMdata functions (that return data) should now return tibbles or data.tables. If you use <code>NMdataConfig</code> to control this, for reproducibility please do so explicitly in your script and not in your <code>.Rprofile</code> or similar.</p>
</div>
<div id="the-help-of-an-nmdata-function-says-i-have-to-pass-a-data.frame.-can-i-use-a-tibble-or-data.table" class="section level3">
<h3>The help of an NMdata function says I have to pass a data.frame. Can I use a tibble or data.table?</h3>
<p>Absolutely. data.table’s and tibble’s are data.frame’s, and data.frame in the documentation refers to any of these structures (that technically inherit from the data.frame class).</p>
</div>
<div id="the-result-i-am-getting-back-from-an-nmdata-function-doesnt-print-to-the-r-console.-why" class="section level3">
<h3>The result I am getting back from an NMdata function doesn’t print to the R console. Why?</h3>
<p>This should have been taken care of in most recent NMdata releases. This was something that could happen in earlier versions when working with data.tables - and only when working with data.tables. If you experience this in a &gt;0.0.7 version, pleae file a bug. You would have to print the data.table a couple of times before you see a result in the R terminal.</p>
</div>
<div id="can-i-request-a-feature" class="section level3">
<h3>Can I request a feature?</h3>
<p>Please open an issue on <a href="https://github.com/philipdelff/NMdata/issues">github</a>.</p>
</div>
<div id="any-plans-on-including-some-plotting-functions" class="section level3">
<h3>Any plans on including some plotting functions?</h3>
<p>No. See the question above about dependencies. If NMdata were extended with plotting features, it would become dependent on a number of packages, and backward compatibility would be very dificult to ensure.</p>
<p>The only way to provide plotting features for output from NMdata functions, would be to launch a separate package. I rarely need much code to get the plots I want based on the format returned by <code>NMscanData</code> and maybe a call to <code>findCovs</code> or <code>findVars</code>.</p>
</div>
</div>
<div id="questions-specific-to-data-reading-tools" class="section level2">
<h2>Questions specific to data reading tools</h2>
<div id="how-do-i-customize-the-naming-of-input-and-output-control-streams" class="section level3">
<h3>How do I customize the naming of input and output control streams?</h3>
<p><code>NMscanData</code> needs the path to the output control stream (technically, the input control stream will work too, but this is not recommended). It has no requirement to the naming of files.</p>
<p>By default, <code>NMscanData</code> expects a <a href="https://uupharmacometrics.github.io/PsN/">PSN</a>-style naming of input and output control streams. This means that if the input control stream is called <code>model.mod</code>, the returned control stream is called <code>model.lst</code>. If you use a different setup, you can use the <code>file.mod</code> argument. Do one of the following if needed:</p>
<ul>
<li>Explicitly give the path to the input control stream or</li>
<li>Pass a function that translates from the output control stream to the input.</li>
</ul>
<p>Example if the input is called <code>input.txt</code> and the output is called <code>output.txt</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>out2in &lt;-<span class="st"> </span><span class="cf">function</span>(file) <span class="kw">file.path</span>(<span class="kw">dirname</span>(file), <span class="st">&quot;input.txt&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>res &lt;-<span class="st"> </span><span class="kw">NMscanData</span>(<span class="st">&quot;path/to/output.txt&quot;</span>, <span class="dt">file.mod =</span> out2in)</span></code></pre></div>
<p>You can use <code>NMdataConf</code> to configure the default behaviour to match your setup:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">NMdataConf</span>(<span class="dt">file.mod =</span> out2in)</span></code></pre></div>
<p><code>NMscanData</code> take the name of the model from the file name and adds it to a column in the returned data. If the name of the directory is the model name, you can do the following as well:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">NMdataConfig</span>(<span class="dt">modelname =</span> <span class="cf">function</span>(file) <span class="kw">basename</span>(<span class="kw">dirname</span>(<span class="kw">normalizePath</span>(file))))</span></code></pre></div>
<p>Feel free to modify the function to omit parts of the string or add to it.</p>
</div>
<div id="what-is-input-and-output-data" class="section level3">
<h3>What is “input” and output data?</h3>
<ul>
<li>What is referred to as “input data” in NMdata documentation is the datafile read in the <code>$DATA</code> or <code>$INFILE</code>.</li>
<li>What is referred to as “output data” in the same documentation is the totality of files written by <code>$TABLE</code> statements.</li>
</ul>
<p>Notice especially, “output data” does not refer to any of the files automatically written by Nonmem such as <code>.phi</code>, <code>.ext</code>, <code>.cov</code> etc.</p>
</div>
<div id="does-nmdata-read-.phi-.ext-.cov-and-other-files-generated-by-nonmem" class="section level3">
<h3>Does NMdata read .phi, .ext, .cov and other files generated by Nonmem?</h3>
<p>No. Reading this data is often very useful, but there are other tools out there that do this (e.g. <code>nonmem2R</code>).</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
